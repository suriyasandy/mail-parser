import os
import nltk
from rake_nltk import Rake

# 1) Compute absolute path to your local nltk_data folder
HERE = os.path.dirname(os.path.abspath(__file__))
PROJECT_ROOT = os.path.dirname(HERE)
LOCAL_NLTK = os.path.join(PROJECT_ROOT, "nltk_data")

# 2) Tell NLTK to look there first
nltk.data.path.insert(0, LOCAL_NLTK)

# 3) (Optional) Load stopwords manually if you want full control
stopwords_file = os.path.join(
    LOCAL_NLTK, "corpora", "stopwords", "english"
)
with open(stopwords_file, encoding="utf-8") as f:
    local_stopwords = [w.strip() for w in f if w.strip()]

# 4) Instantiate RAKE with your local stopwords
_rake = Rake(
    stopwords=local_stopwords,
    min_length=1,
    max_length=3
)

def extract_keywords(text: str, top_n: int = 10) -> list[str]:
    """
    Extracts top_n key phrases from text using RAKE, 
    pulling stopwords from your local nltk_data.
    """
    _rake.extract_keywords_from_text(text)
    return _rake.get_ranked_phrases()[:top_n]
