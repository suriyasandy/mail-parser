import email
from email import policy
from email.parser import BytesParser
import re

def load_email(file_path):
    with open(file_path, 'rb') as f:
        msg = BytesParser(policy=policy.default).parse(f)

    subject = msg['subject']
    sender = msg['from']
    date = msg['date']

    # Prefer plain text
    if msg.is_multipart():
        for part in msg.walk():
            if part.get_content_type() == 'text/plain':
                body = part.get_payload(decode=True).decode(part.get_content_charset('utf-8'))
                break
        else:
            body = ""  # fallback
    else:
        body = msg.get_payload(decode=True).decode(msg.get_content_charset('utf-8'))

    return {
        'subject': subject,
        'from': sender,
        'date': date,
        'body': body
    }

def split_mail_chain(body):
    # Splits emails in a mail chain (basic heuristic)
    pattern = r'\nOn .+ wrote:\n'  # basic split on "On [date], X wrote:"
    return re.split(pattern, body)
