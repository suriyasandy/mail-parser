def run_easyocr_with_custom_ner(image_input, model_path="model-best"):
    import easyocr
    import numpy as np
    from PIL import Image
    from io import BytesIO
    import spacy

    # Load OCR and NER
    reader = easyocr.Reader(['en'])
    nlp = spacy.load(model_path)

    # Step 1: OCR Input Handling
    if isinstance(image_input, str):
        ocr_result = reader.readtext(image_input, detail=0)
    elif isinstance(image_input, bytes):
        img = Image.open(BytesIO(image_input))
        ocr_result = reader.readtext(np.array(img), detail=0)
    elif isinstance(image_input, Image.Image):
        ocr_result = reader.readtext(np.array(image_input), detail=0)
    elif isinstance(image_input, np.ndarray):
        ocr_result = reader.readtext(image_input, detail=0)
    else:
        raise ValueError("Unsupported image input format for EasyOCR.")

    # Step 2: Join OCR lines to text
    extracted_text = " ".join(ocr_result)

    # Step 3: Apply Custom NER
    doc = nlp(extracted_text)
    entities = [(ent.text, ent.label_) for ent in doc.ents]

    # Step 4: Return both text and extracted entities
    return {
        "text": extracted_text,
        "entities": entities
    }
